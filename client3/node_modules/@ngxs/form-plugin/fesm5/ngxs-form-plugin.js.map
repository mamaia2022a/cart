{"version":3,"file":"ngxs-form-plugin.js","sources":["ng://@ngxs/form-plugin/src/actions.ts","ng://@ngxs/form-plugin/src/form.plugin.ts","ng://@ngxs/form-plugin/src/directive.ts","ng://@ngxs/form-plugin/src/form.module.ts"],"sourcesContent":["export class UpdateFormStatus {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Update Form Status';\r\n  }\r\n  constructor(\r\n    public payload: {\r\n      status: string | null;\r\n      path: string;\r\n    }\r\n  ) {}\r\n}\r\n\r\nexport class UpdateFormValue {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Update Form Value';\r\n  }\r\n  constructor(public payload: { value: any; path: string; propertyPath?: string }) {}\r\n}\r\n\r\nexport class UpdateForm {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Update Form';\r\n  }\r\n  constructor(\r\n    public payload: {\r\n      value: any;\r\n      errors: { [k: string]: string } | null;\r\n      dirty: boolean | null;\r\n      status: string | null;\r\n      path: string;\r\n    }\r\n  ) {}\r\n}\r\n\r\nexport class UpdateFormDirty {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Update Form Dirty';\r\n  }\r\n  constructor(public payload: { dirty: boolean | null; path: string }) {}\r\n}\r\n\r\nexport class SetFormDirty {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Set Form Dirty';\r\n  }\r\n  constructor(public payload: string) {}\r\n}\r\n\r\nexport class SetFormPristine {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Set Form Pristine';\r\n  }\r\n  constructor(public payload: string) {}\r\n}\r\n\r\nexport class UpdateFormErrors {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Update Form Errors';\r\n  }\r\n  constructor(public payload: { errors: { [k: string]: string } | null; path: string }) {}\r\n}\r\n\r\nexport class SetFormDisabled {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Set Form Disabled';\r\n  }\r\n  constructor(public payload: string) {}\r\n}\r\n\r\nexport class SetFormEnabled {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Set Form Enabled';\r\n  }\r\n  constructor(public payload: string) {}\r\n}\r\n\r\nexport class ResetForm {\r\n  static get type() {\r\n    // NOTE: Not necessary to declare the type in this way in your code. See https://github.com/ngxs/store/pull/644#issuecomment-436003138\r\n    return '[Forms] Reset Form';\r\n  }\r\n  constructor(public payload: { path: string; value?: any }) {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  getActionTypeFromInstance,\r\n  getValue,\r\n  NgxsNextPluginFn,\r\n  NgxsPlugin,\r\n  setValue\r\n} from '@ngxs/store';\r\nimport {\r\n  ResetForm,\r\n  SetFormDirty,\r\n  SetFormDisabled,\r\n  SetFormEnabled,\r\n  SetFormPristine,\r\n  UpdateForm,\r\n  UpdateFormDirty,\r\n  UpdateFormErrors,\r\n  UpdateFormStatus,\r\n  UpdateFormValue\r\n} from './actions';\r\n\r\n@Injectable()\r\nexport class NgxsFormPlugin implements NgxsPlugin {\r\n  handle(state: any, event: any, next: NgxsNextPluginFn) {\r\n    const type = getActionTypeFromInstance(event);\r\n\r\n    let nextState = state;\r\n\r\n    if (type === UpdateFormValue.type || type === UpdateForm.type || type === ResetForm.type) {\r\n      const { value } = event.payload;\r\n      const payloadValue = Array.isArray(value) ? value.slice() : { ...value };\r\n      const path = this.joinPathWithPropertyPath(event);\r\n      nextState = setValue(nextState, path, payloadValue);\r\n    }\r\n\r\n    if (type === ResetForm.type) {\r\n      const model = getValue(nextState, `${event.payload.path}.model`);\r\n      nextState = setValue(nextState, `${event.payload.path}`, { model: model });\r\n    }\r\n\r\n    if (type === UpdateFormStatus.type || type === UpdateForm.type) {\r\n      nextState = setValue(nextState, `${event.payload.path}.status`, event.payload.status);\r\n    }\r\n\r\n    if (type === UpdateFormErrors.type || type === UpdateForm.type) {\r\n      nextState = setValue(nextState, `${event.payload.path}.errors`, {\r\n        ...event.payload.errors\r\n      });\r\n    }\r\n\r\n    if (type === UpdateFormDirty.type || type === UpdateForm.type) {\r\n      nextState = setValue(nextState, `${event.payload.path}.dirty`, event.payload.dirty);\r\n    }\r\n\r\n    if (type === SetFormDirty.type) {\r\n      nextState = setValue(nextState, `${event.payload}.dirty`, true);\r\n    }\r\n\r\n    if (type === SetFormPristine.type) {\r\n      nextState = setValue(nextState, `${event.payload}.dirty`, false);\r\n    }\r\n\r\n    if (type === SetFormDisabled.type) {\r\n      nextState = setValue(nextState, `${event.payload}.disabled`, true);\r\n    }\r\n\r\n    if (type === SetFormEnabled.type) {\r\n      nextState = setValue(nextState, `${event.payload}.disabled`, false);\r\n    }\r\n\r\n    return next(nextState, event);\r\n  }\r\n\r\n  private joinPathWithPropertyPath({ payload }: UpdateFormValue): string {\r\n    let path = `${payload.path}.model`;\r\n\r\n    if (payload.propertyPath) {\r\n      path += `.${payload.propertyPath}`;\r\n    }\r\n\r\n    return path;\r\n  }\r\n}\r\n","import { ChangeDetectorRef, Directive, Input, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormGroup, FormGroupDirective } from '@angular/forms';\r\nimport { Actions, getValue, ofActionDispatched, Store } from '@ngxs/store';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged, filter, takeUntil } from 'rxjs/operators';\r\nimport {\r\n  ResetForm,\r\n  UpdateForm,\r\n  UpdateFormDirty,\r\n  UpdateFormErrors,\r\n  UpdateFormStatus,\r\n  UpdateFormValue\r\n} from './actions';\r\n\r\n@Directive({ selector: '[ngxsForm]' })\r\nexport class FormDirective implements OnInit, OnDestroy {\r\n  @Input('ngxsForm')\r\n  path: string = null!;\r\n\r\n  @Input('ngxsFormDebounce')\r\n  debounce = 100;\r\n\r\n  @Input('ngxsFormClearOnDestroy')\r\n  set clearDestroy(val: boolean) {\r\n    this._clearDestroy = val != null && `${val}` !== 'false';\r\n  }\r\n\r\n  get clearDestroy(): boolean {\r\n    return this._clearDestroy;\r\n  }\r\n\r\n  _clearDestroy = false;\r\n\r\n  private readonly _destroy$ = new Subject<void>();\r\n  private _updating = false;\r\n\r\n  constructor(\r\n    private _actions$: Actions,\r\n    private _store: Store,\r\n    private _formGroupDirective: FormGroupDirective,\r\n    private _cd: ChangeDetectorRef\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this._actions$\r\n      .pipe(\r\n        ofActionDispatched(ResetForm),\r\n        filter((action: ResetForm) => action.payload.path === this.path),\r\n        takeUntil(this._destroy$)\r\n      )\r\n      .subscribe(({ payload: { value } }: ResetForm) => {\r\n        this.form.reset(value);\r\n        this.updateFormStateWithRawValue(true);\r\n        this._cd.markForCheck();\r\n      });\r\n\r\n    this.getStateStream(`${this.path}.model`).subscribe(model => {\r\n      if (this._updating || !model) {\r\n        return;\r\n      }\r\n\r\n      this.form.patchValue(model);\r\n      this._cd.markForCheck();\r\n    });\r\n\r\n    this.getStateStream(`${this.path}.dirty`).subscribe(dirty => {\r\n      if (this.form.dirty === dirty || typeof dirty !== 'boolean') {\r\n        return;\r\n      }\r\n\r\n      if (dirty) {\r\n        this.form.markAsDirty();\r\n      } else {\r\n        this.form.markAsPristine();\r\n      }\r\n\r\n      this._cd.markForCheck();\r\n    });\r\n\r\n    // On first state change, sync form model, status and dirty with state\r\n    this._store\r\n      .selectOnce(state => getValue(state, this.path))\r\n      .subscribe(() => {\r\n        this._store.dispatch([\r\n          new UpdateFormValue({\r\n            path: this.path,\r\n            value: this.form.getRawValue()\r\n          }),\r\n          new UpdateFormStatus({\r\n            path: this.path,\r\n            status: this.form.status\r\n          }),\r\n          new UpdateFormDirty({\r\n            path: this.path,\r\n            dirty: this.form.dirty\r\n          })\r\n        ]);\r\n      });\r\n\r\n    this.getStateStream(`${this.path}.disabled`).subscribe(disabled => {\r\n      if (this.form.disabled === disabled || typeof disabled !== 'boolean') {\r\n        return;\r\n      }\r\n\r\n      if (disabled) {\r\n        this.form.disable();\r\n      } else {\r\n        this.form.enable();\r\n      }\r\n\r\n      this._cd.markForCheck();\r\n    });\r\n\r\n    this._formGroupDirective.valueChanges!.pipe(this.debounceChange()).subscribe(() => {\r\n      this.updateFormStateWithRawValue();\r\n    });\r\n\r\n    this._formGroupDirective\r\n      .statusChanges!.pipe(distinctUntilChanged(), this.debounceChange())\r\n      .subscribe((status: string) => {\r\n        this._store.dispatch(\r\n          new UpdateFormStatus({\r\n            status,\r\n            path: this.path\r\n          })\r\n        );\r\n      });\r\n  }\r\n\r\n  updateFormStateWithRawValue(withFormStatus?: boolean) {\r\n    if (this._updating) return;\r\n\r\n    const value = this._formGroupDirective.control.getRawValue();\r\n\r\n    const actions: any[] = [\r\n      new UpdateFormValue({\r\n        path: this.path,\r\n        value\r\n      }),\r\n      new UpdateFormDirty({\r\n        path: this.path,\r\n        dirty: this._formGroupDirective.dirty\r\n      }),\r\n      new UpdateFormErrors({\r\n        path: this.path,\r\n        errors: this._formGroupDirective.errors\r\n      })\r\n    ];\r\n\r\n    if (withFormStatus) {\r\n      actions.push(\r\n        new UpdateFormStatus({\r\n          path: this.path,\r\n          status: this._formGroupDirective.status\r\n        })\r\n      );\r\n    }\r\n\r\n    this._updating = true;\r\n    this._store.dispatch(actions).subscribe({\r\n      error: () => (this._updating = false),\r\n      complete: () => (this._updating = false)\r\n    });\r\n  }\r\n  ngOnDestroy() {\r\n    this._destroy$.next();\r\n    this._destroy$.complete();\r\n\r\n    if (this.clearDestroy) {\r\n      this._store.dispatch(\r\n        new UpdateForm({\r\n          path: this.path,\r\n          value: null,\r\n          dirty: null,\r\n          status: null,\r\n          errors: null\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  private debounceChange() {\r\n    const skipDebounceTime =\r\n      this._formGroupDirective.control.updateOn !== 'change' || this.debounce < 0;\r\n\r\n    return skipDebounceTime\r\n      ? (change: Observable<any>) => change.pipe(takeUntil(this._destroy$))\r\n      : (change: Observable<any>) =>\r\n          change.pipe(debounceTime(this.debounce), takeUntil(this._destroy$));\r\n  }\r\n\r\n  private get form(): FormGroup {\r\n    return this._formGroupDirective.form;\r\n  }\r\n\r\n  private getStateStream(path: string) {\r\n    return this._store.select(state => getValue(state, path)).pipe(takeUntil(this._destroy$));\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { NGXS_PLUGINS } from '@ngxs/store';\r\nimport { NgxsFormPlugin } from './form.plugin';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { FormDirective } from './directive';\r\n\r\n@NgModule({\r\n  imports: [ReactiveFormsModule],\r\n  declarations: [FormDirective],\r\n  exports: [FormDirective]\r\n})\r\nexport class NgxsFormPluginModule {\r\n  static forRoot(): ModuleWithProviders<NgxsFormPluginModule> {\r\n    return {\r\n      ngModule: NgxsFormPluginModule,\r\n      providers: [\r\n        {\r\n          provide: NGXS_PLUGINS,\r\n          useClass: NgxsFormPlugin,\r\n          multi: true\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}